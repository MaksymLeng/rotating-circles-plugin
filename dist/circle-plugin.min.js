var r=class{constructor(t,e=[],s={}){this.container=document.getElementById(t),this.books=e,this.config={radius:s.radius||150,speed:s.speed||.01,mode:s.mode||"circular",maxFps:s.maxFps||60,randomSpeedRange:s.randomSpeedRange||[.5,2]},this.parentAngle=0,this.isPaused=!1,this.circlesData=[],this.lastFrameTime=0,this.config.mode==="random"&&this.container.classList.add("random-mode"),this.init()}init(){this.books.forEach(t=>this.addBookCircle(t)),this.animate()}addBook(t){this.books.push(t),this.addBookCircle(t)}addBookCircle(t){let e=document.createElement("div");e.classList.add("book-circle",t.status);let s=t.status==="read"?"\u2705":t.status==="reading"?"\u{1F4D6}":"\u{1F4CC}";e.innerHTML=`
            <div class="book-content">
                <span class="book-icon">${s}</span>
                <span class="book-title">${t.title[0].toUpperCase()}</span>
                <div class="book-details">
                    <p>Autor: ${t.author}</p>
                    <p>Title: ${t.title}</p>
                    <p>Genre: ${t.genre||"_"}</p>
                </div>
            </div>
        `;let i;e.addEventListener("click",()=>{clearTimeout(i),e.classList.contains("expanded")?i=setTimeout(()=>{if(t.fileName){let n=new CustomEvent("book-open-requested",{detail:{fileName:t.fileName,book:t}});window.dispatchEvent(n)}},300):(e.classList.add("expanded"),this.isPaused=!0)}),e.addEventListener("dblclick",n=>{n.stopPropagation(),clearTimeout(i),e.classList.remove("expanded"),this.isPaused=!1}),document.addEventListener("click",n=>{!n.target.closest(".book-circle")&&!document.getElementById("readerModal")&&(this.isPaused=!1,e.classList.remove("expanded"),this.container.querySelectorAll(".book-circle.expanded").forEach(o=>{o.classList.remove("expanded")}))}),this.container.appendChild(e),this.config.mode==="random"&&this.initRandomData(),this.updatePositions()}updatePositions(){this.config.mode==="circular"?this.updateCircularPosition():this.updateRandomPosition()}setMode(t){this.config.mode=t,t==="random"?(this.container.classList.add("random-mode"),this.initRandomData()):this.container.classList.remove("random-mode"),this.updatePositions()}updateCircularPosition(){let t=this.container.querySelectorAll(".book-circle"),e=t.length,s=this.config.radius;t.forEach((i,n)=>{let o=2*Math.PI/e*n+this.parentAngle,c=200,d=200,l=c+s*Math.cos(o),h=d+s*Math.sin(o);i.style.left=`${l}px`,i.style.top=`${h}px`,this.updateBookContent(i,o)})}updateBookContent(t,e){let s=t.querySelector(".book-content"),i=e*180/Math.PI;t.classList.contains("expanded")?s.style.transform="rotate(0deg)":this.isPaused||(s.style.transform=`rotate(${-i+180}deg)`)}initRandomData(){this.circlesData=[];let t=this.container.getBoundingClientRect();this.container.querySelectorAll(".book-circle").forEach(s=>{let i=Math.random()*t.width,n=Math.random()*t.height,[a,o]=this.config.randomSpeedRange,c=(Math.random()*(o-a)+a)*(Math.random()<.5?-1:1),d=(Math.random()*(o-a)+a)*(Math.random()<.5?-1:1);this.circlesData.push({element:s,x:i,y:n,vx:c,vy:d,angle:Math.random()*360,rotationRate:(Math.random()-.7)*.7}),s.style.left=`${i}px`,s.style.top=`${n}px`})}updateRandomPosition(){let t=this.container.getBoundingClientRect();this.circlesData.forEach(e=>{this.isPaused||(e.x+=e.vx,e.y+=e.vy,e.x<0&&(e.x=0,e.vx*=-1),e.x>t.width&&(e.x=t.width,e.vx*=-1),e.y<0&&(e.y=0,e.vy*=-1),e.y>t.height&&(e.y=t.height,e.vy*=-1)),e.element.style.left=`${e.x}px`,e.element.style.top=`${e.y}px`,e.angle+=e.rotationRate,this.updateBookContent(e.element,e.angle*Math.PI/180)})}animate(t){if(t-this.lastFrameTime<1e3/this.config.maxFps){requestAnimationFrame(this.animate.bind(this));return}this.lastFrameTime=t,this.config.mode==="circular"&&!this.isPaused&&(this.parentAngle+=this.config.speed),this.updatePositions(),requestAnimationFrame(this.animate.bind(this))}};export{r as default};
